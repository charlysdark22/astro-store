---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { createClient } from '@supabase/supabase-js';

// Obtener variables de entorno
const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;

// Crear cliente de Supabase
const supabase = createClient(supabaseUrl, supabaseAnonKey);

// T√≠tulo de la p√°gina
const title = "3 EN 1 TECNO - Tecnolog√≠a al mejor precio";

// Cargar productos desde Supabase
const { data: productos, error } = await supabase
  .from('productos')
  .select('*')
  .order('precio', { ascending: true });

if (error) {
  console.error('Error al cargar productos:', error);
}


// Funci√≥n para formatear precios en Guaran√≠es
const formatPrice = (p) => {
  // Formatea el n√∫mero con puntos como separador de miles, sin s√≠mbolo
  const formattedNumber = new Intl.NumberFormat('es-PY', {
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  }).format(p);
  return `${formattedNumber} MN`; // Ej: "5.000 MN"
};

// N√∫mero de WhatsApp (con c√≥digo de pa√≠s, ej: +595 983 539322 ‚Üí 595983539322)
const whatsappNumber = "595983539322"; // ‚ö†Ô∏è Reemplaza con tu n√∫mero real
---

<Layout title={title}>
  <Header />

  <main class="container mx-auto px-4 py-8">
    <!-- Secci√≥n de promoci√≥n principal -->
    <section class="bg-gradient-to-r from-red-600 to-orange-500 text-white text-center py-12 rounded-lg shadow-lg mb-10">
      <h1 class="text-4xl md:text-5xl font-bold">üî• ¬°3 EN 1 TECNO! üî•</h1>
      <p class="text-xl md:text-2xl mb-6">¬°Precios imbatibles en tecnolog√≠a!</p>
      <p class="text-lg opacity-90">Aprovecha estas ofertas por tiempo limitado</p>
    </section>

    <!-- Mensaje de error si falla la carga -->
    {error && (
      <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-8 rounded">
        <p><strong>‚ö†Ô∏è Error:</strong> No se pudieron cargar los productos. Intenta m√°s tarde.</p>
      </div>
    )}

    <!-- Productos -->
    <section class="mb-12">
      <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Productos Destacados</h2>

      {productos?.length === 0 ? (
        <p class="text-center text-gray-600">No hay productos disponibles por ahora.</p>
      ) : (
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
          {productos?.map((producto) => (
                <div key={producto.id} class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300 flex flex-col">
              <img
                src={producto.imagen_url}
                alt={producto.nombre}
                class="w-full h-48 object-cover"
                loading="lazy"
              />
              <div class="p-6 flex-grow">
                <h3 class="text-xl font-semibold text-gray-800">{producto.nombre}</h3>
                <span class="text-sm text-blue-600 font-medium">{producto.categoria}</span>
                <p class="text-gray-600 text-sm mt-2">{producto.descripcion}</p>
                <p class="text-red-600 font-bold text-lg mt-3">{formatPrice(producto.precio)}</p>
              </div>
              <div class="p-6 pt-0">
                <a
                  href={`https://wa.me/${whatsappNumber}?text=Hola!%20Quiero%20comprar%20el%20producto:%20${encodeURIComponent(
                    producto.nombre
                  )}`}
                  target="_blank"
                  rel="noopener"
                  class="block w-full text-center bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition font-semibold"
                >
                  üì≤ Comprar por WhatsApp
                </a>
              </div>
            </div>
          ))}
        </div>
      )}
    </section>

    <!-- Llamado a la acci√≥n final -->
    <section class="bg-blue-900 text-white text-center py-10 rounded-lg shadow-md">
      <h2 class="text-2xl font-bold mb-4">¬øQu√© necesit√°s?</h2>
      <p class="text-lg mb-6">Escribime ahora y te ayudo con tu compra</p>
      <a
        href={`https://wa.me/${whatsappNumber}?text=Hola!%20Vine%20de%20tu%20web%20y%20quiero%20m√°s%20info`}
        target="_blank"
        rel="noopener"
        class="inline-block bg-green-500 hover:bg-green-600 text-white font-bold px-8 py-3 rounded-full transition transform hover:scale-105"
      >
        üí¨ Chatear por WhatsApp
      </a>
    </section>
  </main>

  <Footer />
</Layout>